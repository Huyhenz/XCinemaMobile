# ğŸš€ HÆ°á»›ng Dáº«n TÃ­ch Há»£p Checkout.vn

Checkout.vn lÃ  cá»•ng thanh toÃ¡n trung gian há»— trá»£ nhiá»u phÆ°Æ¡ng thá»©c thanh toÃ¡n: **ZaloPay, VNPay, MoMo, vÃ  nhiá»u cá»•ng khÃ¡c**. Báº¡n **KHÃ”NG Cáº¦N** Ä‘Äƒng kÃ½ tá»«ng cá»•ng riÃªng láº»!

## âœ… Æ¯u Äiá»ƒm Checkout.vn

- âœ… **KHÃ”NG cáº§n Ä‘Äƒng kÃ½ ZaloPay trá»±c tiáº¿p** - Checkout.vn xá»­ lÃ½ táº¥t cáº£
- âœ… Há»— trá»£ nhiá»u cá»•ng thanh toÃ¡n: ZaloPay, VNPay, MoMo, v.v.
- âœ… API Ä‘Æ¡n giáº£n, tÃ­ch há»£p nhanh (1-2 giá»)
- âœ… CÃ³ sandbox Ä‘á»ƒ test miá»…n phÃ­
- âœ… Há»— trá»£ tá»‘t, tÃ i liá»‡u Ä‘áº§y Ä‘á»§

## ğŸ“‹ Má»¥c Lá»¥c

1. [ÄÄƒng KÃ½ TÃ i Khoáº£n](#1-Ä‘Äƒng-kÃ½-tÃ i-khoáº£n)
2. [Táº¡o Website](#2-táº¡o-website)
3. [Láº¥y API Credentials](#3-láº¥y-api-credentials)
4. [Cáº¥u HÃ¬nh Trong Project](#4-cáº¥u-hÃ¬nh-trong-project)
5. [Test Thanh ToÃ¡n](#5-test-thanh-toÃ¡n)
6. [Troubleshooting](#6-troubleshooting)

---

## 1. ÄÄƒng KÃ½ TÃ i Khoáº£n

### BÆ°á»›c 1: Truy Cáº­p Checkout.vn

1. Truy cáº­p: **https://checkout.vn**
2. Click **"ÄÄƒng kÃ½"** hoáº·c **"Táº¡o tÃ i khoáº£n"**

### BÆ°á»›c 2: Äiá»n ThÃ´ng Tin

Äiá»n cÃ¡c thÃ´ng tin cáº§n thiáº¿t:
- **Email**: Email cá»§a báº¡n
- **Máº­t kháº©u**: Táº¡o máº­t kháº©u máº¡nh
- **Sá»‘ Ä‘iá»‡n thoáº¡i**: SÄT cá»§a báº¡n
- **TÃªn cÃ´ng ty/Website**: TÃªn project cá»§a báº¡n (vÃ­ dá»¥: "XCinema")

### BÆ°á»›c 3: XÃ¡c Thá»±c Email

1. Kiá»ƒm tra email Ä‘á»ƒ xÃ¡c thá»±c tÃ i khoáº£n
2. Click vÃ o link xÃ¡c thá»±c trong email
3. HoÃ n táº¥t Ä‘Äƒng kÃ½

---

## 2. Táº¡o Website

Sau khi Ä‘Äƒng nháº­p, báº¡n cáº§n táº¡o má»™t Website Ä‘á»ƒ quáº£n lÃ½ giao dá»‹ch:

### BÆ°á»›c 1: VÃ o Má»¥c Website

1. ÄÄƒng nháº­p vÃ o **https://checkout.vn**
2. VÃ o menu **"Website"** hoáº·c **"Quáº£n lÃ½ Website"**
3. Click **"+ ThÃªm má»›i"** hoáº·c **"Táº¡o Website má»›i"**

### BÆ°á»›c 2: Äiá»n ThÃ´ng Tin Website

Äiá»n cÃ¡c thÃ´ng tin:
- **TÃªn website**: TÃªn project cá»§a báº¡n (vÃ­ dá»¥: "XCinema Mobile")
- **Äá»‹a chá»‰ website**: URL cá»§a app/website (vÃ­ dá»¥: `https://xcinema.app`)
- **MÃ´ táº£**: MÃ´ táº£ ngáº¯n vá» website/app

### BÆ°á»›c 3: LÆ°u Website

1. Click **"LÆ°u"** hoáº·c **"Táº¡o"**
2. Website ID sáº½ Ä‘Æ°á»£c táº¡o tá»± Ä‘á»™ng (báº¡n sáº½ cáº§n ID nÃ y sau)

---

## 3. Láº¥y API Credentials

### BÆ°á»›c 1: VÃ o Pháº§n CÃ i Äáº·t

1. ÄÄƒng nháº­p vÃ o **https://checkout.vn**
2. VÃ o menu **"CÃ i Ä‘áº·t"** hoáº·c **"Settings"**
3. Chá»n **"API key"** hoáº·c **"API Keys"**

### BÆ°á»›c 2: Láº¥y API Key vÃ  API Token

Báº¡n sáº½ tháº¥y:
- **API Key**: Má»™t chuá»—i kÃ½ tá»± dÃ i (vÃ­ dá»¥: `ck_live_xxxxxxxxxxxxx`)
- **API Token**: Má»™t chuá»—i kÃ½ tá»± dÃ i khÃ¡c (vÃ­ dá»¥: `sk_live_xxxxxxxxxxxxx`)

**LÆ°u Ã½:**
- âš ï¸ **KHÃ”NG** chia sáº» API Key vÃ  Token cÃ´ng khai
- âš ï¸ **KHÃ”NG** commit vÃ o Git
- âœ… LÆ°u vÃ o file `.env` (Ä‘Ã£ cÃ³ trong `.gitignore`)

### BÆ°á»›c 3: Láº¥y Website ID

1. VÃ o menu **"Website"**
2. Chá»n website báº¡n vá»«a táº¡o
3. Copy **Website ID** (thÆ°á»ng lÃ  sá»‘ hoáº·c chuá»—i kÃ½ tá»±)

---

## 4. Cáº¥u HÃ¬nh Trong Project

### BÆ°á»›c 1: Cáº­p Nháº­t File `.env`

Má»Ÿ file `.env` vÃ  thÃªm cÃ¡c thÃ´ng tin sau:

```env
# Checkout.vn Configuration
CHECKOUT_API_KEY=your_checkout_api_key_here
CHECKOUT_API_TOKEN=your_checkout_api_token_here
CHECKOUT_WEBSITE_ID=your_checkout_website_id_here
CHECKOUT_RETURN_URL=https://xcinema.app/checkout/callback
CHECKOUT_CANCEL_URL=https://xcinema.app/checkout/cancel
```

**VÃ­ dá»¥ thá»±c táº¿:**
```env
# Checkout.vn Configuration
CHECKOUT_API_KEY=ck_live_abc123xyz789
CHECKOUT_API_TOKEN=sk_live_def456uvw012
CHECKOUT_WEBSITE_ID=12345
CHECKOUT_RETURN_URL=https://xcinema.app/checkout/callback
CHECKOUT_CANCEL_URL=https://xcinema.app/checkout/cancel
```

**LÆ°u Ã½:**
- Thay `your_checkout_api_key_here` báº±ng API Key tháº­t tá»« Checkout.vn
- Thay `your_checkout_api_token_here` báº±ng API Token tháº­t
- Thay `your_checkout_website_id_here` báº±ng Website ID tháº­t
- Return URL vÃ  Cancel URL cÃ³ thá»ƒ dÃ¹ng URL máº·c Ä‘á»‹nh (khÃ´ng cáº§n thiáº¿t pháº£i cÃ³ tháº­t)

### BÆ°á»›c 2: Kiá»ƒm Tra Code ÄÃ£ TÃ­ch Há»£p

Code Ä‘Ã£ Ä‘Æ°á»£c tÃ­ch há»£p sáºµn trong:
- âœ… `lib/services/payment_service.dart` - Service xá»­ lÃ½ thanh toÃ¡n
- âœ… `lib/screens/payment_screen.dart` - UI chá»n phÆ°Æ¡ng thá»©c thanh toÃ¡n

**Payment Method:** `PaymentMethod.checkout`

### BÆ°á»›c 3: Cháº¡y á»¨ng Dá»¥ng

```bash
flutter run
```

Khi cháº¡y, kiá»ƒm tra console logs:
- `âœ… Checkout.vn credentials found in .env` - Náº¿u tháº¥y dÃ²ng nÃ y, credentials Ä‘Ã£ Ä‘Æ°á»£c load
- `ğŸ“ Using Checkout.vn: Website ID: [id]` - Website ID Ä‘Ã£ Ä‘Æ°á»£c load

---

## 5. Test Thanh ToÃ¡n

### BÆ°á»›c 1: Chá»n Checkout.vn Trong App

1. Má»Ÿ á»©ng dá»¥ng
2. Chá»n gháº¿ vÃ  thanh toÃ¡n
3. Trong mÃ n hÃ¬nh thanh toÃ¡n, chá»n **"Checkout.vn"**
4. Click **"XÃC NHáº¬N THANH TOÃN"**

### BÆ°á»›c 2: Chá»n PhÆ°Æ¡ng Thá»©c Thanh ToÃ¡n

WebView sáº½ má»Ÿ vá»›i trang Checkout.vn, báº¡n cÃ³ thá»ƒ chá»n:
- **ZaloPay** - Thanh toÃ¡n qua ZaloPay
- **VNPay** - Thanh toÃ¡n qua VNPay
- **MoMo** - Thanh toÃ¡n qua MoMo
- VÃ  nhiá»u phÆ°Æ¡ng thá»©c khÃ¡c

### BÆ°á»›c 3: HoÃ n Táº¥t Thanh ToÃ¡n

1. Chá»n phÆ°Æ¡ng thá»©c thanh toÃ¡n (vÃ­ dá»¥: ZaloPay)
2. ÄÄƒng nháº­p vÃ  xÃ¡c nháº­n thanh toÃ¡n
3. Kiá»ƒm tra káº¿t quáº£ trong app

---

## 6. Troubleshooting

### Lá»—i: "Checkout.vn chÆ°a Ä‘Æ°á»£c cáº¥u hÃ¬nh"

**NguyÃªn nhÃ¢n:**
- Credentials chÆ°a Ä‘Æ°á»£c thÃªm vÃ o `.env`
- File `.env` chÆ°a Ä‘Æ°á»£c load

**Giáº£i phÃ¡p:**
1. Kiá»ƒm tra file `.env` cÃ³ Ä‘Ãºng tÃªn khÃ´ng (cÃ³ dáº¥u cháº¥m á»Ÿ Ä‘áº§u)
2. Kiá»ƒm tra file `.env` cÃ³ á»Ÿ root project khÃ´ng
3. Kiá»ƒm tra credentials cÃ³ Ä‘Ãºng format khÃ´ng
4. Äáº£m báº£o `main.dart` Ä‘Ã£ load `.env`:
   ```dart
   await dotenv.load(fileName: ".env");
   ```

### Lá»—i: "KhÃ´ng thá»ƒ táº¡o giao dá»‹ch Checkout.vn"

**NguyÃªn nhÃ¢n:**
- API Key hoáº·c Token sai
- Website ID sai
- API endpoint khÃ´ng Ä‘Ãºng

**Giáº£i phÃ¡p:**
1. Kiá»ƒm tra API Key vÃ  Token trong `.env` cÃ³ Ä‘Ãºng khÃ´ng
2. Kiá»ƒm tra Website ID cÃ³ Ä‘Ãºng khÃ´ng
3. Xem console logs Ä‘á»ƒ biáº¿t lá»—i cá»¥ thá»ƒ
4. Kiá»ƒm tra káº¿t ná»‘i máº¡ng

### Lá»—i: "Payment URL not found in response"

**NguyÃªn nhÃ¢n:**
- API response format khÃ´ng Ä‘Ãºng
- Checkout.vn API Ä‘Ã£ thay Ä‘á»•i format

**Giáº£i phÃ¡p:**
1. Xem console logs Ä‘á»ƒ xem response body
2. Kiá»ƒm tra tÃ i liá»‡u API má»›i nháº¥t cá»§a Checkout.vn
3. Cáº­p nháº­t code náº¿u cáº§n (trong `_createCheckoutTransaction`)

### API Tráº£ Vá» Lá»—i 401 (Unauthorized)

**NguyÃªn nhÃ¢n:**
- API Key hoáº·c Token khÃ´ng Ä‘Ãºng
- Token Ä‘Ã£ háº¿t háº¡n

**Giáº£i phÃ¡p:**
1. Kiá»ƒm tra láº¡i API Key vÃ  Token trong Checkout.vn dashboard
2. Táº¡o API Token má»›i náº¿u cáº§n
3. Cáº­p nháº­t láº¡i trong `.env`

### API Tráº£ Vá» Lá»—i 400 (Bad Request)

**NguyÃªn nhÃ¢n:**
- Thiáº¿u hoáº·c sai parameters
- Website ID khÃ´ng tá»“n táº¡i

**Giáº£i phÃ¡p:**
1. Kiá»ƒm tra táº¥t cáº£ parameters cÃ³ Ä‘áº§y Ä‘á»§ khÃ´ng
2. Kiá»ƒm tra Website ID cÃ³ Ä‘Ãºng khÃ´ng
3. Xem console logs Ä‘á»ƒ biáº¿t parameter nÃ o sai

---

## ğŸ“š TÃ i Liá»‡u Tham Kháº£o

- **Checkout.vn**: https://checkout.vn
- **TÃ i liá»‡u API**: https://help.checkout.vn/api-tao-giao-dich-moi.html
- **HÆ°á»›ng dáº«n tÃ­ch há»£p**: https://help.checkout.vn/Huong-dan-tich-hop-cong-thanh-toan.html
- **API thÃ´ng tin thanh toÃ¡n**: https://help.checkout.vn/api-thong-tin-thanh-toan-cua-don-hang.html

---

## âš ï¸ LÆ°u Ã Quan Trá»ng

1. **Báº£o Máº­t Credentials**:
   - âŒ KHÃ”NG commit `.env` lÃªn Git (Ä‘Ã£ cÃ³ trong `.gitignore`)
   - âŒ KHÃ”NG chia sáº» API Key vÃ  Token cÃ´ng khai
   - âœ… Chá»‰ dÃ¹ng credentials trong `.env` file

2. **Sandbox vs Production**:
   - Checkout.vn cÃ³ sandbox Ä‘á»ƒ test
   - DÃ¹ng sandbox credentials khi test
   - DÃ¹ng production credentials khi ra máº¯t

3. **Return URL vÃ  Cancel URL**:
   - URL nÃ y khÃ´ng cáº§n pháº£i tá»“n táº¡i tháº­t
   - Checkout.vn sáº½ redirect vá» URL nÃ y sau khi thanh toÃ¡n
   - App sáº½ detect URL pattern Ä‘á»ƒ biáº¿t káº¿t quáº£ thanh toÃ¡n

4. **PhÆ°Æ¡ng Thá»©c Thanh ToÃ¡n**:
   - Checkout.vn há»— trá»£ nhiá»u phÆ°Æ¡ng thá»©c
   - NgÆ°á»i dÃ¹ng chá»n phÆ°Æ¡ng thá»©c trÃªn trang Checkout.vn
   - Báº¡n khÃ´ng cáº§n cáº¥u hÃ¬nh tá»«ng phÆ°Æ¡ng thá»©c riÃªng

---

## âœ… Checklist

TrÆ°á»›c khi test, Ä‘áº£m báº£o:

- [ ] ÄÃ£ Ä‘Äƒng kÃ½ tÃ i khoáº£n Checkout.vn
- [ ] ÄÃ£ táº¡o Website trong Checkout.vn
- [ ] ÄÃ£ láº¥y API Key, API Token, vÃ  Website ID
- [ ] ÄÃ£ thÃªm credentials vÃ o `.env`
- [ ] ÄÃ£ kiá»ƒm tra `CHECKOUT_API_KEY` khÃ´ng rá»—ng
- [ ] ÄÃ£ kiá»ƒm tra `CHECKOUT_API_TOKEN` khÃ´ng rá»—ng
- [ ] ÄÃ£ kiá»ƒm tra `CHECKOUT_WEBSITE_ID` khÃ´ng rá»—ng
- [ ] ÄÃ£ cháº¡y `flutter run` vÃ  test thanh toÃ¡n

---

## ğŸ¯ TÃ³m Táº¯t Quy TrÃ¬nh

1. **ÄÄƒng kÃ½** â†’ https://checkout.vn
2. **Táº¡o Website** â†’ Láº¥y Website ID
3. **Láº¥y API Keys** â†’ CÃ i Ä‘áº·t â†’ API key
4. **ThÃªm vÃ o `.env`** â†’ Cáº¥u hÃ¬nh credentials
5. **Test** â†’ Cháº¡y app vÃ  test thanh toÃ¡n

---

**ChÃºc báº¡n tÃ­ch há»£p thÃ nh cÃ´ng! ğŸ‰**

Náº¿u gáº·p váº¥n Ä‘á», hÃ£y xem pháº§n Troubleshooting hoáº·c liÃªn há»‡ há»— trá»£ Checkout.vn.



